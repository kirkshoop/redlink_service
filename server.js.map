{"version":3,"sources":["src/server.js"],"names":[],"mappings":"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","file":"server.js","sourcesContent":["\r\nimport azure from 'azure';\r\nimport Rx from 'rx';\r\nimport superagent from 'superagent';\r\nimport xmlparser from 'superagent-xml2jsparser';\r\n//require('superagent-proxy')(superagent);\r\n\r\nimport eventHubs from 'eventhubs-js';\r\n\r\nimport http from 'http';\r\n\r\nvar Observable = Rx.Observable;\r\n\r\nvar port = process.env.PORT || 8111;\r\n\r\nhttp.createServer(function(req, res) {\r\n  res.writeHead(200, { 'Content-Type': 'text/plain' });\r\n  res.end('Hello World\\n');\r\n}).listen(port);\r\n\r\n\r\nvar AppID = process.env.RlAppid;\r\nvar AppAuth = process.env.RlAppAuth;\r\nvar Username = process.env.RlUsername;\r\nvar Password = process.env.RlPassword;\r\nvar Session = process.env.RlSession;\r\n\r\nvar eventHubNamespace = process.env.EbNamespace;\r\nvar eventHubName = process.env.EbName;\r\n\r\nvar eventHubPolicyName = process.env.EbPolicyName;\r\nvar eventHubPolicyKey = process.env.EbPolicyKey;\r\n\r\n// begin https://raw.githubusercontent.com/noodlefrenzy/event-hub-client/master/lib/saToken.js\r\n\r\n//\r\n// Copyright (c) Microsoft and contributors.  All rights reserved.\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//   http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n//\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n//\r\n\r\nvar crypto = require('crypto');\r\nvar utf8 = require('utf8');\r\n\r\n/**\r\n * Creates a new Shared Access Token for use in the Authorization header of ServiceBus/EventHub calls.\r\n *\r\n * @param {string} namespace    The ServiceBus Namespace to use.\r\n * @param {string} hubName      The EventHub name.\r\n * @param {string} saName       The Shared Access Policy name.\r\n * @param {string} saKey        The Shared Access Policy key.\r\n * @return {string}             A Shared Access token string.\r\n *\r\n */\r\nfunction createSharedAccessToken(namespace, hubName, saName, saKey) {\r\n    if (!namespace || !hubName || !saName || !saKey) {\r\n        throw \"Missing required parameter\";\r\n    }\r\n\r\n    var uri = 'https://' + namespace +\r\n        '.servicebus.windows.net/' + hubName + '/';\r\n\r\n    var encoded = encodeURIComponent(uri);\r\n    \r\n    var epoch = new Date(1970, 1, 1, 0, 0, 0, 0);\r\n    var now = new Date();\r\n    var year = 365 * 24 * 60 * 60;\r\n    var ttl = ((now.getTime() - epoch.getTime()) / 1000) + (year * 5);\r\n\r\n    var signature = encoded + '\\n' + ttl;\r\n    var signatureUTF8 = utf8.encode(signature);\r\n    var hash = crypto.createHmac('sha256', saKey).update(signatureUTF8).digest('base64');\r\n\r\n    return 'SharedAccessSignature sr=' + encoded + '&sig=' + \r\n        encodeURIComponent(hash) + '&se=' + ttl + '&skn=' + saName;\r\n}\r\n// end https://raw.githubusercontent.com/noodlefrenzy/event-hub-client/master/lib/saToken.js\r\n\r\nvar eventHubSasToken = createSharedAccessToken(eventHubNamespace, eventHubName, eventHubPolicyName, eventHubPolicyKey);\r\n\r\neventHubs.init({\r\n    hubNamespace: eventHubNamespace,\r\n    hubName: eventHubName,\r\n    sasToken: eventHubSasToken\r\n});\r\n\r\nclass RedlinkApi\r\n{\r\n  constructor(AppId, AppAuth) {\r\n    this.uri = 'https://tccna.honeywell.com';\r\n    this.appid = AppId;\r\n    this.appauth = AppAuth;\r\n    this.login$ = Observable.fromNodeCallback(this.login, this);\r\n    this.getLocations$ = Observable.fromNodeCallback(this.getLocations, this);\r\n    this.getThermostat$ = Observable.fromNodeCallback(this.getThermostat, this);\r\n  }\r\n\r\n  call(path, form, cb) {\r\n    superagent.\r\n      post(this.uri + '/ws/MobileV2.asmx' + path).\r\n//      proxy(process.env.https_proxy).\r\n      type('form').\r\n      send(form).\r\n      accept('xml').\r\n      parse(xmlparser).\r\n      end((err, resp) => {cb(err, resp && resp.body);});\r\n  }\r\n\r\n\tlogin(username, password, cb) {\r\n\t\tthis.call(\r\n      '/AuthenticateUserLogin', \r\n      {username: username, password: password, applicationID: this.appid, applicationVersion: '2', uiLanguage: 'English'}, \r\n      cb);\r\n\t}\r\n\r\n  getLocations(session, cb) {\r\n    this.call(\r\n      '/GetLocations', \r\n      {sessionID: session}, \r\n      cb);\r\n  }\r\n\r\n  getThermostat(session, thermostat, cb) {\r\n    this.call(\r\n      '/GetThermostat', \r\n      {sessionID: session, thermostatID: thermostat}, \r\n      cb);\r\n  }\r\n\r\n\r\n};\r\n\r\nlet api = new RedlinkApi(AppID, AppAuth);\r\n\r\nlet thermostat$ = (session$, period) => {\r\n  console.log('get thermostat data every ' + period / 1000 + 's');\r\n  return session$.\r\n    flatMap(session => {\r\n      console.log('using session: ' + session);\r\n      return Observable.interval(period).startWith(0).\r\n        flatMap(_ => api.getLocations$(session).\r\n          flatMap(locations => Observable.of(locations.GetLocationsResult.Locations).\r\n            flatMap(location => Observable.of(location[0].LocationInfo[0].Thermostats).\r\n              map(thermostat => {\r\n                location[0].LocationInfo[0].Thermostats = undefined;\r\n                return {location: location[0].LocationInfo[0], thermostat: thermostat[0].ThermostatInfo[0]};\r\n              }).\r\n              tap(thermostatAt => {\r\n                  var location = thermostatAt.location;\r\n                  var thermostat = thermostatAt.thermostat;\r\n                  var UI = thermostat.UI[0];\r\n                  var Fan = thermostat.Fan[0];\r\n                  var Unit = UI.DisplayedUnits[0];\r\n                  var message = {\r\n                      create: UI.Created[0], \r\n                      locationName: location.Name[0],\r\n                      unit: Unit,\r\n                      outdoorTemp: '' + Number(UI.OutdoorTemp[0]),\r\n                      thermostatName: thermostat.UserDefinedDeviceName[0],\r\n                      thermostatTemp: '' + Number(UI.DispTemperature[0]),\r\n                      thermostatHumidity: UI.IndoorHumidity[0],\r\n                      heatSetPoint: '' + Number(UI.HeatSetpoint[0]),\r\n                      coolSetPoint: '' + Number(UI.CoolSetpoint[0]),\r\n                      statusHeat: UI.StatusHeat[0],\r\n                      statusCool: UI.StatusCool[0],\r\n                      fanPosition: Fan.Position[0],\r\n                      fanIsRunning: Fan.IsFanRunning[0]['$']['xsi:nil'] === \"true\"\r\n                    };\r\n                  eventHubs.sendMessage({\r\n                      message:  message,\r\n                      deviceId: thermostatAt.thermostat.ThermostatID[0],\r\n                  });\r\n              }))));});\r\n};\r\n\r\nlet withNewLogin$ = (e) => {  \r\n  console.log(e);\r\n  console.log('new login..');\r\n  let login = api.login$(Username, Password).\r\n    retry().\r\n    map(body => {\r\n      console.log(\"logged in: \" + body.AuthenticateLoginResult.SessionID[0]);\r\n      return body.AuthenticateLoginResult.SessionID[0];\r\n    });\r\n  return thermostat$(login, 1000 * 10).\r\n    catch(withNewLogin$);\r\n};\r\n\r\nthermostat$(Observable.of(Session), 1000 * 10).\r\n  catch(withNewLogin$).\r\n  subscribe(thermostatAt => {\r\n    var location = thermostatAt.location;\r\n    console.log(location.CurrentWeather[0]);\r\n    var thermostat = thermostatAt.thermostat;\r\n    var UI = thermostat.UI[0];\r\n    var Unit = UI.DisplayedUnits[0];\r\n\r\n    console.log('Now: ' + new Date().toGMTString() + ', At: ' + UI.Created[0] + ', Outside - ' + location.Name[0] + ': ' + Number(UI.OutdoorTemp[0]) + Unit + ', Inside - ' + thermostat.UserDefinedDeviceName[0] + ': ' + Number(UI.DispTemperature[0]) + Unit);\r\n  }, error => {\r\n    console.log(\"failed - \" + error);\r\n  });\r\n"]}